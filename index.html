<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="apple-mobile-web-app-title" content="Life OS">
<title>Joey's Life OS</title>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --bg: #f5f6fa;
  --bg2: #ffffff;
  --surface: #ffffff;
  --surface2: #f0f2f8;
  --surface3: #e8ebf4;
  --border: #e2e5f0;
  --border2: #d0d4e8;
  --text: #1a1d2e;
  --text2: #4a4f6e;
  --text3: #8a90b0;
  --accent: #4f7cff;
  --accent-dim: rgba(79,124,255,0.1);
  --green: #22c07a;
  --green-dim: rgba(34,192,122,0.1);
  --orange: #ff7240;
  --orange-dim: rgba(255,114,64,0.1);
  --red: #ff4d6d;
  --red-dim: rgba(255,77,109,0.1);
  --yellow: #f59e0b;
  --yellow-dim: rgba(245,158,11,0.1);
  --purple: #8b5cf6;
  --purple-dim: rgba(139,92,246,0.1);
  --teal: #0ea5e9;
  --nav-w: 240px;
  --radius: 16px;
  --shadow: 0 2px 12px rgba(0,0,0,0.07);
  --shadow-md: 0 4px 24px rgba(0,0,0,0.1);
}

*{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent;}

body{
  background:var(--bg);
  color:var(--text);
  font-family:'Plus Jakarta Sans',sans-serif;
  display:flex;
  min-height:100vh;
  overflow-x:hidden;
  font-size:16px;
}

/* ‚îÄ‚îÄ‚îÄ SIDEBAR ‚îÄ‚îÄ‚îÄ */
.sidebar{
  width:var(--nav-w);
  background:var(--bg2);
  border-right:1px solid var(--border);
  display:flex;
  flex-direction:column;
  position:fixed;
  top:0;left:0;bottom:0;
  z-index:200;
  transition:transform 0.3s cubic-bezier(0.4,0,0.2,1);
  overflow-y:auto;
  box-shadow:var(--shadow);
}

.sidebar-logo{
  padding:30px 22px 22px;
  border-bottom:1px solid var(--border);
}

.logo-text{
  font-family:'Syne',sans-serif;
  font-size:22px;
  font-weight:800;
  letter-spacing:-0.02em;
  color:var(--text);
}

.logo-sub{
  font-size:12px;
  color:var(--text3);
  margin-top:3px;
  font-weight:600;
  letter-spacing:0.06em;
  text-transform:uppercase;
}

.sidebar-date{
  padding:16px 22px;
  border-bottom:1px solid var(--border);
  font-size:13px;
  color:var(--text3);
  font-weight:500;
}

.sidebar-date strong{
  display:block;
  font-size:15px;
  color:var(--text2);
  font-family:'Syne',sans-serif;
  font-weight:700;
  margin-bottom:2px;
}

nav{padding:12px 12px;flex:1;}

.nav-item{
  display:flex;
  align-items:center;
  gap:12px;
  padding:13px 14px;
  border-radius:12px;
  cursor:pointer;
  font-size:15px;
  font-weight:600;
  color:var(--text2);
  transition:all 0.15s;
  margin-bottom:3px;
  border:1px solid transparent;
}

.nav-item:hover{background:var(--surface2);color:var(--text);}
.nav-item.active{background:var(--accent-dim);color:var(--accent);border-color:rgba(79,124,255,0.2);}
.nav-icon{font-size:18px;width:22px;text-align:center;}

/* ‚îÄ‚îÄ‚îÄ MAIN ‚îÄ‚îÄ‚îÄ */
.main{
  margin-left:var(--nav-w);
  flex:1;
  min-height:100vh;
  display:flex;
  flex-direction:column;
}

.topbar{
  display:none;
  padding:16px 18px;
  background:var(--bg2);
  border-bottom:1px solid var(--border);
  align-items:center;
  gap:12px;
  position:sticky;top:0;z-index:100;
  box-shadow:var(--shadow);
}

.menu-btn{background:none;border:none;color:var(--text);font-size:24px;cursor:pointer;padding:4px;}
.topbar-title{font-family:'Syne',sans-serif;font-weight:800;font-size:18px;}

.content{padding:32px 32px;flex:1;}

.page{display:none;animation:fadein 0.2s ease;}
.page.active{display:block;}
@keyframes fadein{from{opacity:0;transform:translateY(8px);}to{opacity:1;transform:translateY(0);}}

/* ‚îÄ‚îÄ‚îÄ TYPOGRAPHY ‚îÄ‚îÄ‚îÄ */
.page-title{
  font-family:'Syne',sans-serif;
  font-size:32px;
  font-weight:800;
  letter-spacing:-0.03em;
  margin-bottom:6px;
  color:var(--text);
}

.page-sub{font-size:15px;color:var(--text3);margin-bottom:28px;font-weight:500;}

.section-title{
  font-family:'Syne',sans-serif;
  font-size:12px;
  font-weight:700;
  letter-spacing:0.1em;
  text-transform:uppercase;
  color:var(--text3);
  margin:28px 0 12px;
}

/* ‚îÄ‚îÄ‚îÄ CARDS ‚îÄ‚îÄ‚îÄ */
.card{
  background:var(--surface);
  border:1px solid var(--border);
  border-radius:var(--radius);
  padding:22px;
  margin-bottom:16px;
  box-shadow:var(--shadow);
}

.card-header{
  display:flex;justify-content:space-between;align-items:center;
  margin-bottom:18px;
}

.card-title{
  font-family:'Syne',sans-serif;
  font-size:17px;
  font-weight:700;
  color:var(--text);
}

/* ‚îÄ‚îÄ‚îÄ INPUTS ‚îÄ‚îÄ‚îÄ */
input[type=text],input[type=number],input[type=date],input[type=time],textarea,select{
  background:var(--surface2);
  border:1.5px solid var(--border);
  border-radius:12px;
  padding:13px 16px;
  color:var(--text);
  font-family:'Plus Jakarta Sans',sans-serif;
  font-size:15px;
  outline:none;
  width:100%;
  transition:border-color 0.15s;
  -webkit-appearance:none;
  appearance:none;
}

input:focus,textarea:focus,select:focus{border-color:var(--accent);background:#fff;}
textarea{resize:vertical;min-height:90px;}

.row{display:flex;gap:10px;margin-bottom:12px;align-items:flex-start;}
.row input,.row select{margin-bottom:0;}
.col{flex:1;}

/* ‚îÄ‚îÄ‚îÄ BUTTONS ‚îÄ‚îÄ‚îÄ */
.btn{
  background:var(--accent);color:#fff;border:none;
  border-radius:12px;padding:13px 20px;
  font-family:'Plus Jakarta Sans',sans-serif;font-size:15px;font-weight:700;
  cursor:pointer;white-space:nowrap;transition:opacity 0.15s,transform 0.1s;
  box-shadow:0 2px 8px rgba(79,124,255,0.25);
}
.btn:active{opacity:0.85;transform:scale(0.97);}
.btn.green{background:var(--green);color:#fff;box-shadow:0 2px 8px rgba(34,192,122,0.25);}
.btn.orange{background:var(--orange);color:#fff;box-shadow:0 2px 8px rgba(255,114,64,0.25);}
.btn.red{background:var(--red);box-shadow:none;}
.btn.ghost{background:var(--surface2);color:var(--text2);border:1.5px solid var(--border);box-shadow:none;}
.btn.sm{padding:9px 14px;font-size:13px;}
.btn.xs{padding:5px 10px;font-size:12px;}

.del-btn{
  background:none;border:none;color:var(--text3);
  font-size:18px;cursor:pointer;padding:3px 7px;line-height:1;
  border-radius:8px;transition:color 0.15s,background 0.15s;
}
.del-btn:hover{color:var(--red);background:var(--red-dim);}

/* ‚îÄ‚îÄ‚îÄ BADGES ‚îÄ‚îÄ‚îÄ */
.badge{
  display:inline-block;
  border-radius:8px;
  padding:3px 10px;
  font-size:12px;font-weight:700;
  text-transform:uppercase;letter-spacing:0.05em;
}
.badge.high{background:var(--red-dim);color:var(--red);}
.badge.medium{background:var(--yellow-dim);color:var(--yellow);}
.badge.low{background:var(--green-dim);color:var(--green);}
.badge.accent{background:var(--accent-dim);color:var(--accent);}
.badge.purple{background:var(--purple-dim);color:var(--purple);}
.badge.orange{background:var(--orange-dim);color:var(--orange);}
.badge.work{background:var(--accent-dim);color:var(--accent);}
.badge.personal{background:var(--green-dim);color:var(--green);}
.badge.health{background:var(--red-dim);color:var(--red);}
.badge.finance{background:var(--yellow-dim);color:var(--yellow);}

/* ‚îÄ‚îÄ‚îÄ PROGRESS BAR ‚îÄ‚îÄ‚îÄ */
.prog-wrap{background:var(--surface2);border-radius:99px;height:8px;overflow:hidden;margin:6px 0;}
.prog-fill{height:100%;border-radius:99px;background:var(--accent);transition:width 0.4s ease;}
.prog-fill.green{background:var(--green);}
.prog-fill.orange{background:var(--orange);}

/* ‚îÄ‚îÄ‚îÄ GRID ‚îÄ‚îÄ‚îÄ */
.grid2{display:grid;grid-template-columns:1fr 1fr;gap:16px;}
.grid3{display:grid;grid-template-columns:repeat(3,1fr);gap:14px;}

/* ‚îÄ‚îÄ‚îÄ STAT TILES ‚îÄ‚îÄ‚îÄ */
.stat-tile{
  background:var(--surface);
  border:1px solid var(--border);
  border-radius:var(--radius);
  padding:20px;
  text-align:center;
  box-shadow:var(--shadow);
}
.stat-num{
  font-family:'Syne',sans-serif;
  font-size:34px;font-weight:800;
  line-height:1;
}
.stat-lbl{font-size:12px;color:var(--text3);font-weight:700;margin-top:6px;text-transform:uppercase;letter-spacing:0.06em;}

/* ‚îÄ‚îÄ‚îÄ WEEK GRID (DASHBOARD) ‚îÄ‚îÄ‚îÄ */
.week-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:8px;margin-bottom:8px;}
.week-day-hd{text-align:center;font-size:11px;font-weight:700;color:var(--text3);text-transform:uppercase;padding-bottom:6px;}
.week-day-cell{
  background:var(--surface2);border:1.5px solid var(--border);
  border-radius:12px;padding:8px 4px;min-height:70px;
  cursor:pointer;transition:border-color 0.15s;
}
.week-day-cell:hover{border-color:var(--accent);}
.week-day-cell.today{border-color:var(--accent);background:var(--accent-dim);}
.week-day-num{font-size:14px;font-weight:800;font-family:'Syne',sans-serif;margin-bottom:4px;text-align:center;}
.week-event-dot{height:5px;width:5px;border-radius:50%;margin:2px auto;}

/* ‚îÄ‚îÄ‚îÄ TODOS ‚îÄ‚îÄ‚îÄ */
.week-tabs{display:flex;gap:6px;flex-wrap:wrap;margin-bottom:18px;}
.week-tab{
  background:var(--surface2);border:1.5px solid var(--border);
  border-radius:10px;padding:8px 14px;font-size:13px;font-weight:700;
  cursor:pointer;transition:all 0.15s;color:var(--text2);
  font-family:'Plus Jakarta Sans',sans-serif;
}
.week-tab.active{background:var(--accent);color:#fff;border-color:var(--accent);box-shadow:0 2px 8px rgba(79,124,255,0.3);}
.week-tab.has-tasks{border-color:var(--accent);color:var(--accent);}

.todo-item{
  display:flex;align-items:flex-start;gap:12px;
  padding:14px 0;border-bottom:1px solid var(--border);
}
.todo-item:last-child{border-bottom:none;}

.check-circle{
  width:24px;height:24px;border-radius:50%;
  border:2.5px solid var(--border2);flex-shrink:0;
  cursor:pointer;display:flex;align-items:center;justify-content:center;
  transition:all 0.2s;margin-top:1px;
}
.check-circle.done{background:var(--green);border-color:var(--green);}
.check-circle.done::after{content:'‚úì';color:#fff;font-size:13px;font-weight:800;}

.todo-body{flex:1;}
.todo-text{font-size:16px;line-height:1.5;font-weight:500;}
.todo-text.done{text-decoration:line-through;color:var(--text3);}
.todo-meta{display:flex;gap:8px;margin-top:5px;align-items:center;flex-wrap:wrap;}

.todo-actions{display:flex;gap:4px;flex-shrink:0;}

.carry-btn{
  background:none;border:1.5px solid var(--border);color:var(--text3);font-size:12px;
  cursor:pointer;padding:4px 9px;border-radius:8px;
  transition:all 0.15s;font-family:'Plus Jakarta Sans',sans-serif;font-weight:600;
}
.carry-btn:hover{color:var(--orange);border-color:var(--orange);background:var(--orange-dim);}

/* ‚îÄ‚îÄ‚îÄ GOALS ‚îÄ‚îÄ‚îÄ */
.goal-cat-header{
  display:flex;align-items:center;gap:10px;
  font-family:'Syne',sans-serif;font-size:17px;font-weight:700;
  margin:24px 0 12px;
}
.cat-dot{width:12px;height:12px;border-radius:50%;flex-shrink:0;}

.goal-card{
  background:var(--surface);
  border:1px solid var(--border);
  border-radius:14px;
  padding:20px;
  margin-bottom:12px;
  box-shadow:var(--shadow);
}
.goal-name{font-weight:700;font-size:16px;margin-bottom:6px;}
.goal-prog-label{display:flex;justify-content:space-between;font-size:13px;color:var(--text3);margin-bottom:4px;font-weight:600;}

.milestone{
  display:flex;align-items:center;gap:10px;
  padding:10px 0;border-bottom:1px dashed var(--border);
  font-size:15px;
}
.milestone:last-child{border-bottom:none;}

.ms-check{
  width:20px;height:20px;border-radius:6px;
  border:2.5px solid var(--border2);flex-shrink:0;
  cursor:pointer;display:flex;align-items:center;justify-content:center;
  transition:all 0.15s;
}
.ms-check.done{background:var(--accent);border-color:var(--accent);}
.ms-check.done::after{content:'‚úì';color:#fff;font-size:11px;font-weight:800;}
.ms-text.done{text-decoration:line-through;color:var(--text3);}

/* ‚îÄ‚îÄ‚îÄ RECIPES ‚îÄ‚îÄ‚îÄ */
.recipe-filters{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:18px;}
.filter-pill{
  background:var(--surface2);border:1.5px solid var(--border);
  border-radius:99px;padding:7px 16px;font-size:13px;font-weight:600;
  cursor:pointer;transition:all 0.15s;color:var(--text2);
}
.filter-pill.active,.filter-pill:hover{background:var(--accent-dim);border-color:var(--accent);color:var(--accent);}

.search-bar{position:relative;margin-bottom:16px;}
.search-bar input{padding-left:40px;}
.search-icon{position:absolute;left:14px;top:50%;transform:translateY(-50%);color:var(--text3);font-size:16px;}

.recipe-card{
  background:var(--surface);
  border:1px solid var(--border);
  border-radius:var(--radius);
  margin-bottom:12px;
  overflow:hidden;
  box-shadow:var(--shadow);
}
.recipe-header{
  display:flex;align-items:center;justify-content:space-between;
  padding:18px 20px;cursor:pointer;
}
.recipe-title{font-family:'Syne',sans-serif;font-size:17px;font-weight:700;}
.recipe-body{padding:0 20px 20px;border-top:1px solid var(--border);display:none;}
.recipe-body.open{display:block;}
.recipe-section{font-size:12px;font-weight:700;letter-spacing:0.08em;text-transform:uppercase;color:var(--text3);margin:14px 0 8px;}
.recipe-ingredient{font-size:15px;padding:4px 0;color:var(--text2);}
.recipe-ingredient::before{content:'¬∑';margin-right:8px;color:var(--accent);}
.recipe-step{display:flex;gap:12px;font-size:15px;padding:6px 0;line-height:1.6;}
.step-num{
  width:26px;height:26px;border-radius:50%;
  background:var(--accent-dim);color:var(--accent);
  font-size:12px;font-weight:800;
  display:flex;align-items:center;justify-content:center;flex-shrink:0;margin-top:1px;
}

/* ‚îÄ‚îÄ‚îÄ CALENDAR ‚îÄ‚îÄ‚îÄ */
.cal-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:20px;}
.cal-month{font-family:'Syne',sans-serif;font-size:22px;font-weight:800;}
.cal-btn{background:var(--surface2);border:1.5px solid var(--border);color:var(--text2);border-radius:10px;padding:10px 16px;cursor:pointer;font-size:16px;transition:all 0.15s;font-weight:700;}
.cal-btn:hover{border-color:var(--accent);color:var(--accent);}

.cal-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:6px;}
.cal-dh{text-align:center;font-size:12px;font-weight:700;letter-spacing:0.07em;color:var(--text3);text-transform:uppercase;padding:6px 0 10px;}
.cal-cell{
  min-height:90px;border-radius:12px;border:1.5px solid var(--border);
  background:var(--surface);padding:8px;cursor:pointer;
  transition:border-color 0.15s,box-shadow 0.15s;
  box-shadow:var(--shadow);
}
.cal-cell:hover{border-color:var(--accent);box-shadow:0 2px 12px rgba(79,124,255,0.15);}
.cal-cell.today{border-color:var(--accent);background:var(--accent-dim);}
.cal-cell.other-month{opacity:0.35;box-shadow:none;}
.cal-dn{font-size:14px;font-weight:800;font-family:'Syne',sans-serif;margin-bottom:4px;}
.cal-event{
  font-size:11px;border-radius:5px;padding:2px 5px;margin-bottom:2px;
  white-space:nowrap;overflow:hidden;text-overflow:ellipsis;font-weight:600;
}
.cal-event.work{background:rgba(79,124,255,0.15);color:var(--accent);}
.cal-event.personal{background:rgba(34,192,122,0.15);color:var(--green);}
.cal-event.health{background:rgba(255,77,109,0.15);color:var(--red);}
.cal-event.finance{background:rgba(245,158,11,0.15);color:var(--yellow);}

/* ‚îÄ‚îÄ‚îÄ HABITS ‚îÄ‚îÄ‚îÄ */
.habit-row{
  display:flex;align-items:center;gap:12px;
  padding:16px 0;border-bottom:1px solid var(--border);
}
.habit-row:last-child{border-bottom:none;}
.habit-info{flex:1;}
.habit-name{font-size:16px;font-weight:600;}
.habit-streak{font-size:13px;color:var(--orange);margin-top:3px;font-weight:700;}
.habit-checks{display:flex;gap:5px;}
.h-check{
  width:32px;height:32px;border-radius:8px;
  border:2px solid var(--border2);
  cursor:pointer;display:flex;align-items:center;justify-content:center;
  font-size:11px;font-weight:700;transition:all 0.15s;
  flex-shrink:0;color:var(--text3);
  font-family:'Syne',sans-serif;
}
.h-check.done{background:var(--green);border-color:var(--green);color:#fff;}
.h-check.today-check{border-color:var(--accent);}

/* ‚îÄ‚îÄ‚îÄ NOTES ‚îÄ‚îÄ‚îÄ */
.note-item{
  background:var(--surface);border:1px solid var(--border);
  border-radius:14px;padding:16px;margin-bottom:12px;
  box-shadow:var(--shadow);
}
.note-date{font-size:12px;color:var(--text3);margin-bottom:8px;font-weight:600;}
.note-text{font-size:15px;line-height:1.7;white-space:pre-wrap;}
.note-header{display:flex;justify-content:space-between;align-items:flex-start;}

.journal-entry{
  background:linear-gradient(135deg,#f0f4ff 0%,#f8f0ff 100%);
  border:1px solid var(--border);
  border-radius:var(--radius);padding:22px;margin-bottom:12px;
  box-shadow:var(--shadow);
}
.journal-date-hd{
  font-family:'Syne',sans-serif;font-size:17px;font-weight:800;
  margin-bottom:12px;color:var(--accent);
}

/* ‚îÄ‚îÄ‚îÄ MODAL ‚îÄ‚îÄ‚îÄ */
.modal-backdrop{
  display:none;position:fixed;inset:0;background:rgba(0,0,0,0.4);
  z-index:500;align-items:center;justify-content:center;padding:20px;
  backdrop-filter:blur(4px);
}
.modal-backdrop.open{display:flex;}
.modal{
  background:var(--surface);border:1px solid var(--border);
  border-radius:20px;padding:28px;width:100%;max-width:500px;
  max-height:90vh;overflow-y:auto;
  box-shadow:var(--shadow-md);
}
.modal-title{font-family:'Syne',sans-serif;font-size:20px;font-weight:800;margin-bottom:20px;}
.modal-actions{display:flex;gap:10px;justify-content:flex-end;margin-top:20px;}
.modal label{display:block;font-size:13px;font-weight:700;color:var(--text2);margin-bottom:6px;text-transform:uppercase;letter-spacing:0.05em;}
.form-group{margin-bottom:14px;}

/* ‚îÄ‚îÄ‚îÄ EMPTY STATE ‚îÄ‚îÄ‚îÄ */
.empty{text-align:center;color:var(--text3);padding:36px 16px;font-size:15px;}
.empty-icon{font-size:36px;margin-bottom:10px;}

/* ‚îÄ‚îÄ‚îÄ MOBILE ‚îÄ‚îÄ‚îÄ */
@media(max-width:768px){
  .sidebar{transform:translateX(-100%);}
  .sidebar.open{transform:translateX(0);}
  .main{margin-left:0;}
  .topbar{display:flex;}
  .content{padding:18px;}
  .grid2{grid-template-columns:1fr;}
  .grid3{grid-template-columns:repeat(2,1fr);}
  .habit-checks{gap:3px;}
  .h-check{width:28px;height:28px;font-size:10px;}
  .week-grid{gap:4px;}
  .cal-cell{min-height:64px;padding:5px;}
  .mobile-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.4);z-index:199;}
  .mobile-overlay.open{display:block;}
  .page-title{font-size:26px;}
}

@media(min-width:769px){
  .sidebar{transform:none!important;}
  .mobile-overlay{display:none!important;}
}

::-webkit-scrollbar{width:5px;}
::-webkit-scrollbar-track{background:transparent;}
::-webkit-scrollbar-thumb{background:var(--border2);border-radius:99px;}
</style>
</head>
<body>

<div class="mobile-overlay" id="mobileOverlay" onclick="closeSidebar()"></div>

<!-- SIDEBAR -->
<aside class="sidebar" id="sidebar">
  <div class="sidebar-logo">
    <div class="logo-text">Life OS</div>
    <div class="logo-sub">Joey's Dashboard</div>
  </div>
  <div class="sidebar-date" id="sidebarDate"></div>
  <nav>
    <div class="nav-item active" onclick="gotoPage('dashboard',this)"><span class="nav-icon">‚ö°</span> Dashboard</div>
    <div class="nav-item" onclick="gotoPage('todos',this)"><span class="nav-icon">‚úì</span> Weekly To-Do</div>
    <div class="nav-item" onclick="gotoPage('goals',this)"><span class="nav-icon">üéØ</span> Macro Goals</div>
    <div class="nav-item" onclick="gotoPage('recipes',this)"><span class="nav-icon">üçΩÔ∏è</span> Recipes</div>
    <div class="nav-item" onclick="gotoPage('calendar',this)"><span class="nav-icon">üìÖ</span> Calendar</div>
    <div class="nav-item" onclick="gotoPage('habits',this)"><span class="nav-icon">üî•</span> Habits</div>
    <div class="nav-item" onclick="gotoPage('notes',this)"><span class="nav-icon">üìù</span> Notes & Journal</div>
  </nav>
</aside>

<!-- MAIN -->
<main class="main">
  <div class="topbar">
    <button class="menu-btn" onclick="toggleSidebar()">‚ò∞</button>
    <div class="topbar-title" id="topbarTitle">Dashboard</div>
  </div>
  <div class="content">

    <!-- DASHBOARD -->
    <div class="page active" id="page-dashboard">
      <div class="page-title">Good <span id="greeting"></span>, Joey.</div>
      <div class="page-sub" id="dashSub"></div>
      <div class="grid3" style="margin-bottom:24px" id="dashStats"></div>
      <div class="section-title">This Week at a Glance</div>
      <div class="card">
        <div id="weekDayHeaders" class="week-grid"></div>
        <div class="week-grid" id="weekGrid"></div>
      </div>
      <div class="grid2">
        <div>
          <div class="section-title">Today's Tasks</div>
          <div class="card" id="dashTodos"></div>
        </div>
        <div>
          <div class="section-title">Active Habits</div>
          <div class="card" id="dashHabits"></div>
        </div>
      </div>
    </div>

    <!-- WEEKLY TO-DO -->
    <div class="page" id="page-todos">
      <div class="page-title">Weekly To-Do</div>
      <div class="page-sub">Plan your entire week ‚Äî tap a day to view and add tasks.</div>

      <div class="week-tabs" id="weekTabs"></div>

      <div class="card" id="todoAddCard">
        <div class="row">
          <input type="text" id="todoInput" placeholder="Add a task..." class="col"/>
          <select id="todoPriority" style="width:120px;flex-shrink:0">
            <option value="high">üî¥ High</option>
            <option value="medium" selected>üü° Medium</option>
            <option value="low">üü¢ Low</option>
          </select>
        </div>
        <button class="btn" onclick="addTodo()" style="width:100%">Add Task</button>
      </div>

      <div class="section-title" id="activeDayLabel">Active</div>
      <div id="todoActiveList"></div>
      <div class="section-title">Completed</div>
      <div id="todoDoneList"></div>
    </div>

    <!-- GOALS -->
    <div class="page" id="page-goals">
      <div class="page-title">Macro Goals</div>
      <div class="page-sub">Long-term goals broken down into milestones.</div>
      <button class="btn" onclick="openGoalModal()" style="margin-bottom:24px">+ New Goal</button>
      <div id="goalsList"></div>
    </div>

    <!-- RECIPES -->
    <div class="page" id="page-recipes">
      <div class="page-title">Recipe Storage</div>
      <div class="page-sub">Your personal cookbook ‚Äî search, filter, tap to expand.</div>
      <div class="search-bar">
        <span class="search-icon">üîç</span>
        <input type="text" id="recipeSearch" placeholder="Search recipes..." oninput="renderRecipes()"/>
      </div>
      <div class="recipe-filters" id="recipeFilters"></div>
      <button class="btn" onclick="openRecipeModal()" style="margin-bottom:18px">+ Add Recipe</button>
      <div id="recipesList"></div>
    </div>

    <!-- CALENDAR -->
    <div class="page" id="page-calendar">
      <div class="page-title">Calendar</div>
      <div class="page-sub">Tap any day to view or add events with times.</div>
      <div class="card">
        <div class="cal-header">
          <button class="cal-btn" onclick="calNav(-1)">‚Äπ</button>
          <div class="cal-month" id="calMonthLabel"></div>
          <button class="cal-btn" onclick="calNav(1)">‚Ä∫</button>
        </div>
        <div class="cal-grid" id="calGrid"></div>
      </div>
      <div class="section-title">Upcoming Events</div>
      <div id="upcomingEvents"></div>
    </div>

    <!-- HABITS -->
    <div class="page" id="page-habits">
      <div class="page-title">Habit Tracker</div>
      <div class="page-sub">Build streaks. Stay consistent.</div>
      <div class="card" style="margin-bottom:16px">
        <div class="row">
          <input type="text" id="habitName" placeholder="New habit (e.g. Drink 1 gallon of water)" class="col"/>
          <button class="btn green" onclick="addHabit()">Add</button>
        </div>
      </div>
      <div class="card" id="habitsList"></div>
    </div>

    <!-- NOTES -->
    <div class="page" id="page-notes">
      <div class="page-title">Notes & Journal</div>
      <div class="page-sub">Quick thoughts and daily reflections.</div>
      <div class="card">
        <div class="card-title" style="margin-bottom:14px">Capture a Thought</div>
        <textarea id="noteInput" placeholder="Type anything..."></textarea>
        <div style="display:flex;gap:10px;margin-top:12px">
          <button class="btn" onclick="addNote(false)">Save Note</button>
          <button class="btn green" onclick="addNote(true)">Save as Journal Entry</button>
        </div>
      </div>
      <div class="section-title">Journal Entries</div>
      <div id="journalList"></div>
      <div class="section-title">Quick Notes</div>
      <div id="notesList"></div>
    </div>

  </div>
</main>

<!-- MODALS -->

<!-- Goal Modal -->
<div class="modal-backdrop" id="goalModal">
  <div class="modal">
    <div class="modal-title">New Macro Goal</div>
    <div class="form-group"><label>Goal Name</label><input type="text" id="gName" placeholder="e.g. Launch side business"/></div>
    <div class="form-group"><label>Category</label>
      <select id="gCat">
        <option value="Health">üèÉ Health</option>
        <option value="Business">üíº Business / Career</option>
        <option value="Financial">üí∞ Financial</option>
        <option value="Personal">‚ù§Ô∏è Personal / Relationships</option>
        <option value="Skills">üß† Skills</option>
      </select>
    </div>
    <div class="form-group"><label>Target / Description</label><input type="text" id="gTarget" placeholder="e.g. Hit $5k/month by Dec"/></div>
    <div class="form-group"><label>Milestones (one per line)</label>
      <textarea id="gMilestones" placeholder="Research market&#10;Build website&#10;Get first client" style="min-height:110px"></textarea>
    </div>
    <div class="modal-actions">
      <button class="btn ghost" onclick="closeModal('goalModal')">Cancel</button>
      <button class="btn green" onclick="saveGoal()">Save Goal</button>
    </div>
  </div>
</div>

<!-- Recipe Modal -->
<div class="modal-backdrop" id="recipeModal">
  <div class="modal">
    <div class="modal-title">New Recipe</div>
    <div class="form-group"><label>Recipe Name</label><input type="text" id="rName" placeholder="e.g. High Protein Bowl"/></div>
    <div class="form-group"><label>Category</label>
      <select id="rCat">
        <option>Breakfast</option><option>Lunch</option><option>Dinner</option>
        <option>Snack</option><option>Meal Prep</option><option>High Protein</option><option>Other</option>
      </select>
    </div>
    <div class="form-group"><label>Ingredients (one per line)</label>
      <textarea id="rIngredients" placeholder="1 cup oats&#10;2 eggs&#10;1 cup milk" style="min-height:100px"></textarea>
    </div>
    <div class="form-group"><label>Instructions (one step per line)</label>
      <textarea id="rSteps" placeholder="Mix dry ingredients&#10;Add wet ingredients&#10;Cook for 25 min" style="min-height:100px"></textarea>
    </div>
    <div class="modal-actions">
      <button class="btn ghost" onclick="closeModal('recipeModal')">Cancel</button>
      <button class="btn orange" onclick="saveRecipe()">Save Recipe</button>
    </div>
  </div>
</div>

<!-- Calendar Event Modal -->
<div class="modal-backdrop" id="calModal">
  <div class="modal">
    <div class="modal-title" id="calModalTitle">Add Event</div>
    <div class="form-group"><label>Event Title</label><input type="text" id="evTitle" placeholder="e.g. Doctor appointment"/></div>
    <div class="form-group"><label>Start Date</label><input type="date" id="evStartDate"/></div>
    <div class="form-group"><label>End Date <span style="color:var(--text3);text-transform:none;font-weight:500">(optional ‚Äî for multi-day events)</span></label><input type="date" id="evEndDate"/></div>
    <div class="form-group"><label>Start Time <span style="color:var(--text3);text-transform:none;font-weight:500">(optional)</span></label><input type="time" id="evStartTime"/></div>
    <div class="form-group"><label>End Time <span style="color:var(--text3);text-transform:none;font-weight:500">(optional)</span></label><input type="time" id="evEndTime"/></div>
    <div class="form-group"><label>Notes <span style="color:var(--text3);text-transform:none;font-weight:500">(optional)</span></label>
      <textarea id="evNotes" placeholder="Any extra details..." style="min-height:60px"></textarea>
    </div>
    <div class="form-group"><label>Category</label>
      <select id="evCat">
        <option value="work">üíº Work</option>
        <option value="personal">üè† Personal</option>
        <option value="health">‚ù§Ô∏è Health</option>
        <option value="finance">üí∞ Finance</option>
      </select>
    </div>
    <div class="modal-actions">
      <button class="btn ghost" onclick="closeModal('calModal')">Cancel</button>
      <button class="btn" onclick="saveEvent()">Save Event</button>
    </div>
  </div>
</div>

<!-- Day View Modal -->
<div class="modal-backdrop" id="dayViewModal">
  <div class="modal">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px">
      <div class="modal-title" style="margin-bottom:0" id="dayViewTitle"></div>
      <button class="btn sm" onclick="addEventFromDayView()">+ Add Event</button>
    </div>
    <input type="hidden" id="dayViewDate"/>
    <div id="dayViewList"></div>
    <div class="modal-actions"><button class="btn ghost" onclick="closeModal('dayViewModal')">Close</button></div>
  </div>
</div>

<!-- Milestone Modal -->
<div class="modal-backdrop" id="msModal">
  <div class="modal">
    <div class="modal-title">Add Milestone</div>
    <input type="text" id="msInput" placeholder="Milestone text..." style="margin-bottom:14px"/>
    <input type="hidden" id="msGoalId"/>
    <div class="modal-actions">
      <button class="btn ghost" onclick="closeModal('msModal')">Cancel</button>
      <button class="btn" onclick="saveMilestone()">Add</button>
    </div>
  </div>
</div>

<script>
// ‚îÄ‚îÄ STORAGE ‚îÄ‚îÄ
const S={
  g:(k)=>{try{return JSON.parse(localStorage.getItem('los_'+k));}catch{return null;}},
  s:(k,v)=>localStorage.setItem('los_'+k,JSON.stringify(v))
};

// ‚îÄ‚îÄ STATE ‚îÄ‚îÄ
let todos=S.g('todos')||[];
let goals=S.g('goals')||[];
let recipes=S.g('recipes')||[];
let events=S.g('events')||[];
let habits=S.g('habits')||[];
let habitLogs=S.g('habitLogs')||{};
let notes=S.g('notes')||[];
let calYear,calMonth;
let activeWeekDay=null; // selected day string for todo tab

const catColors={Health:'#ff4d6d',Business:'#4f7cff',Financial:'#f59e0b',Personal:'#22c07a',Skills:'#8b5cf6'};
const recipeTags=['All','Breakfast','Lunch','Dinner','Snack','Meal Prep','High Protein','Other'];
let activeRecipeFilter='All';

const MONTHS=['January','February','March','April','May','June','July','August','September','October','November','December'];
const DAYS_SHORT=['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];
const DAYS_FULL=['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'];

// ‚îÄ‚îÄ HELPERS ‚îÄ‚îÄ
function todayStr(){return fmtDate(new Date());}
function fmtDate(d){return `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`;}
function parseDate(s){const[y,m,d]=s.split('-').map(Number);return new Date(y,m-1,d);}
function fmtDisplay(s){const d=parseDate(s);return `${MONTHS[d.getMonth()]} ${d.getDate()}, ${d.getFullYear()}`;}
function fmtTime(t){if(!t)return'';const[h,m]=t.split(':').map(Number);const ap=h>=12?'PM':'AM';const hr=h%12||12;return`${hr}:${String(m).padStart(2,'0')} ${ap}`;}

// Get the 7 dates of the current week (Sun-Sat) containing today
function getWeekDates(){
  const today=new Date();
  const dow=today.getDay();
  const days=[];
  for(let i=0;i<7;i++){
    const d=new Date(today);
    d.setDate(today.getDate()-dow+i);
    days.push(fmtDate(d));
  }
  return days;
}

// ‚îÄ‚îÄ NAV ‚îÄ‚îÄ
function gotoPage(id,el){
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  document.querySelectorAll('.nav-item').forEach(n=>n.classList.remove('active'));
  document.getElementById('page-'+id).classList.add('active');
  if(el)el.classList.add('active');
  document.getElementById('topbarTitle').textContent=el?el.textContent.trim():'';
  if(id==='dashboard')renderDashboard();
  if(id==='todos')renderWeekTabs();
  closeSidebar();
}

function toggleSidebar(){
  document.getElementById('sidebar').classList.toggle('open');
  document.getElementById('mobileOverlay').classList.toggle('open');
}
function closeSidebar(){
  document.getElementById('sidebar').classList.remove('open');
  document.getElementById('mobileOverlay').classList.remove('open');
}

function openModal(id){document.getElementById(id).classList.add('open');}
function closeModal(id){document.getElementById(id).classList.remove('open');}
document.querySelectorAll('.modal-backdrop').forEach(m=>{
  m.addEventListener('click',e=>{if(e.target===m)m.classList.remove('open');});
});

// ‚îÄ‚îÄ INIT DATE ‚îÄ‚îÄ
function initDate(){
  const d=new Date();
  const hr=d.getHours();
  document.getElementById('greeting').textContent=hr<12?'morning':hr<17?'afternoon':'evening';
  document.getElementById('dashSub').textContent=`${DAYS_SHORT[d.getDay()]}, ${MONTHS[d.getMonth()]} ${d.getDate()}, ${d.getFullYear()}`;
  document.getElementById('sidebarDate').innerHTML=`<strong>${DAYS_SHORT[d.getDay()]}, ${MONTHS[d.getMonth()]} ${d.getDate()}</strong>${d.getFullYear()}`;
  calYear=d.getFullYear();calMonth=d.getMonth();
  activeWeekDay=todayStr();
}

// ‚îÄ‚îÄ TODOS (WEEKLY) ‚îÄ‚îÄ
function renderWeekTabs(){
  const weekDates=getWeekDates();
  const today=todayStr();
  if(!activeWeekDay||!weekDates.includes(activeWeekDay)) activeWeekDay=today;

  const el=document.getElementById('weekTabs');
  el.innerHTML=weekDates.map(ds=>{
    const d=parseDate(ds);
    const isToday=ds===today;
    const isActive=ds===activeWeekDay;
    const hasTasks=todos.filter(t=>t.date===ds&&!t.done).length>0;
    return `<div class="week-tab ${isActive?'active':hasTasks?'has-tasks':''}" onclick="selectWeekDay('${ds}')">
      <div>${DAYS_SHORT[d.getDay()]}</div>
      <div style="font-size:15px;margin-top:1px">${d.getDate()}</div>
      ${isToday&&!isActive?'<div style="width:5px;height:5px;background:var(--accent);border-radius:50%;margin:2px auto 0"></div>':''}
    </div>`;
  }).join('');

  renderTodos();
}

function selectWeekDay(ds){
  activeWeekDay=ds;
  renderWeekTabs();
}

function addTodo(){
  const txt=document.getElementById('todoInput').value.trim();
  if(!txt)return;
  const date=activeWeekDay||todayStr();
  todos.push({id:Date.now(),text:txt,priority:document.getElementById('todoPriority').value,done:false,date});
  S.s('todos',todos);
  document.getElementById('todoInput').value='';
  renderWeekTabs();
  renderDashboard();
}
document.addEventListener('keydown',e=>{if(e.key==='Enter'&&document.activeElement.id==='todoInput')addTodo();});

function toggleTodo(id){
  const t=todos.find(t=>t.id===id);if(!t)return;
  t.done=!t.done;S.s('todos',todos);renderWeekTabs();renderDashboard();
}

function deleteTodo(id){
  todos=todos.filter(t=>t.id!==id);S.s('todos',todos);renderWeekTabs();renderDashboard();
}

function carryTodo(id){
  const t=todos.find(t=>t.id===id);if(!t)return;
  const d=parseDate(t.date);d.setDate(d.getDate()+1);
  t.date=fmtDate(d);t.done=false;
  S.s('todos',todos);renderWeekTabs();
}

function renderTodos(){
  const date=activeWeekDay||todayStr();
  const d=parseDate(date);
  const label=date===todayStr()?'Today ‚Äî '+DAYS_FULL[d.getDay()]:DAYS_FULL[d.getDay()]+', '+fmtDisplay(date);
  document.getElementById('activeDayLabel').textContent=label;

  const active=todos.filter(t=>t.date===date&&!t.done);
  const done=todos.filter(t=>t.date===date&&t.done);

  const renderItem=(t)=>`
    <div class="todo-item">
      <div class="check-circle ${t.done?'done':''}" onclick="toggleTodo(${t.id})"></div>
      <div class="todo-body">
        <div class="todo-text ${t.done?'done':''}">${t.text}</div>
        <div class="todo-meta">
          <span class="badge ${t.priority}">${t.priority}</span>
        </div>
      </div>
      <div class="todo-actions">
        ${!t.done?`<button class="carry-btn" onclick="carryTodo(${t.id})" title="Move to next day">‚Üí next day</button>`:''}
        <button class="del-btn" onclick="deleteTodo(${t.id})">√ó</button>
      </div>
    </div>`;

  const al=document.getElementById('todoActiveList');
  al.innerHTML=active.length?`<div class="card">${active.map(renderItem).join('')}</div>`:'<div class="empty"><div class="empty-icon">‚úÖ</div>Nothing scheduled ‚Äî add a task above!</div>';

  const dl=document.getElementById('todoDoneList');
  dl.innerHTML=done.length?`<div class="card">${done.map(renderItem).join('')}</div>`:'<div class="empty" style="font-size:14px;padding:16px 0">Nothing completed yet.</div>';
}

// ‚îÄ‚îÄ GOALS ‚îÄ‚îÄ
function openGoalModal(){openModal('goalModal');}

function saveGoal(){
  const name=document.getElementById('gName').value.trim();if(!name)return;
  const milestones=document.getElementById('gMilestones').value.split('\n').filter(l=>l.trim()).map(l=>({id:Date.now()+Math.random(),text:l.trim(),done:false}));
  goals.push({id:Date.now(),name,cat:document.getElementById('gCat').value,target:document.getElementById('gTarget').value,milestones});
  S.s('goals',goals);
  ['gName','gTarget','gMilestones'].forEach(id=>document.getElementById(id).value='');
  closeModal('goalModal');renderGoals();
}

function toggleMilestone(goalId,msId){
  const g=goals.find(g=>g.id===goalId);if(!g)return;
  const ms=g.milestones.find(m=>m.id===msId);if(!ms)return;
  ms.done=!ms.done;S.s('goals',goals);renderGoals();
}

function deleteGoal(id){goals=goals.filter(g=>g.id!==id);S.s('goals',goals);renderGoals();}

function openMsModal(goalId){
  document.getElementById('msGoalId').value=goalId;
  document.getElementById('msInput').value='';
  openModal('msModal');
}

function saveMilestone(){
  const txt=document.getElementById('msInput').value.trim();if(!txt)return;
  const gid=parseInt(document.getElementById('msGoalId').value);
  const g=goals.find(g=>g.id===gid);if(!g)return;
  g.milestones.push({id:Date.now(),text:txt,done:false});
  S.s('goals',goals);closeModal('msModal');renderGoals();
}

function deleteMilestone(goalId,msId){
  const g=goals.find(g=>g.id===goalId);if(!g)return;
  g.milestones=g.milestones.filter(m=>m.id!==msId);
  S.s('goals',goals);renderGoals();
}

function renderGoals(){
  const el=document.getElementById('goalsList');
  if(!goals.length){el.innerHTML='<div class="empty"><div class="empty-icon">üéØ</div>No goals yet. Add your first!</div>';return;}
  const cats=['Health','Business','Financial','Personal','Skills'];
  let html='';
  cats.forEach(cat=>{
    const cg=goals.filter(g=>g.cat===cat);if(!cg.length)return;
    html+=`<div class="goal-cat-header"><div class="cat-dot" style="background:${catColors[cat]}"></div>${cat}</div>`;
    cg.forEach(g=>{
      const total=g.milestones.length;
      const done=g.milestones.filter(m=>m.done).length;
      const pct=total?Math.round((done/total)*100):0;
      html+=`
        <div class="goal-card">
          <div style="display:flex;justify-content:space-between;align-items:flex-start">
            <div>
              <div class="goal-name">${g.name}</div>
              ${g.target?`<div style="font-size:13px;color:var(--text3);margin-bottom:8px;font-weight:500">Target: ${g.target}</div>`:''}
            </div>
            <button class="del-btn" onclick="deleteGoal(${g.id})">√ó</button>
          </div>
          <div class="goal-prog-label"><span>${done}/${total} milestones</span><span>${pct}%</span></div>
          <div class="prog-wrap"><div class="prog-fill ${pct===100?'green':''}" style="width:${pct}%"></div></div>
          <div style="margin-top:14px">
            ${g.milestones.map(ms=>`
              <div class="milestone">
                <div class="ms-check ${ms.done?'done':''}" onclick="toggleMilestone(${g.id},${ms.id})"></div>
                <div class="ms-text" style="flex:1;${ms.done?'text-decoration:line-through;color:var(--text3)':''}">${ms.text}</div>
                <button class="del-btn" style="font-size:14px" onclick="deleteMilestone(${g.id},${ms.id})">√ó</button>
              </div>`).join('')}
          </div>
          <button class="btn ghost sm" style="margin-top:12px" onclick="openMsModal(${g.id})">+ Add Milestone</button>
        </div>`;
    });
  });
  el.innerHTML=html;
}

// ‚îÄ‚îÄ RECIPES ‚îÄ‚îÄ
function openRecipeModal(){openModal('recipeModal');}

function saveRecipe(){
  const name=document.getElementById('rName').value.trim();if(!name)return;
  const ingredients=document.getElementById('rIngredients').value.split('\n').filter(l=>l.trim());
  const steps=document.getElementById('rSteps').value.split('\n').filter(l=>l.trim());
  recipes.push({id:Date.now(),name,cat:document.getElementById('rCat').value,ingredients,steps});
  S.s('recipes',recipes);
  ['rName','rIngredients','rSteps'].forEach(id=>document.getElementById(id).value='');
  closeModal('recipeModal');renderRecipes();
}

function deleteRecipe(id){recipes=recipes.filter(r=>r.id!==id);S.s('recipes',recipes);renderRecipes();}
function toggleRecipeBody(id){document.getElementById('rb-'+id).classList.toggle('open');}

function renderRecipeFilters(){
  document.getElementById('recipeFilters').innerHTML=recipeTags.map(t=>`<div class="filter-pill ${activeRecipeFilter===t?'active':''}" onclick="setRecipeFilter('${t}')">${t}</div>`).join('');
}

function setRecipeFilter(f){activeRecipeFilter=f;renderRecipeFilters();renderRecipes();}

function renderRecipes(){
  renderRecipeFilters();
  const search=document.getElementById('recipeSearch').value.toLowerCase();
  const filtered=recipes.filter(r=>{
    const mf=activeRecipeFilter==='All'||r.cat===activeRecipeFilter;
    const ms=!search||r.name.toLowerCase().includes(search)||r.cat.toLowerCase().includes(search);
    return mf&&ms;
  });
  const el=document.getElementById('recipesList');
  if(!filtered.length){el.innerHTML='<div class="empty"><div class="empty-icon">üçΩÔ∏è</div>No recipes found.</div>';return;}
  el.innerHTML=filtered.map(r=>`
    <div class="recipe-card">
      <div class="recipe-header" onclick="toggleRecipeBody(${r.id})">
        <div>
          <div class="recipe-title">${r.name}</div>
          <span class="badge accent" style="margin-top:5px">${r.cat}</span>
        </div>
        <div style="display:flex;gap:10px;align-items:center">
          <button class="del-btn" onclick="event.stopPropagation();deleteRecipe(${r.id})">√ó</button>
          <span style="color:var(--text3);font-size:18px">‚ñæ</span>
        </div>
      </div>
      <div class="recipe-body" id="rb-${r.id}">
        <div class="recipe-section">Ingredients</div>
        ${r.ingredients.map(i=>`<div class="recipe-ingredient">${i}</div>`).join('')}
        <div class="recipe-section">Instructions</div>
        ${r.steps.map((s,i)=>`<div class="recipe-step"><div class="step-num">${i+1}</div><div>${s}</div></div>`).join('')}
      </div>
    </div>`).join('');
}

// ‚îÄ‚îÄ CALENDAR ‚îÄ‚îÄ
function calNav(dir){calMonth+=dir;if(calMonth>11){calMonth=0;calYear++;}if(calMonth<0){calMonth=11;calYear--;}renderCalendar();}

function openCalModal(dateStr){
  document.getElementById('evStartDate').value=dateStr;
  document.getElementById('evEndDate').value='';
  document.getElementById('evTitle').value='';
  document.getElementById('evStartTime').value='';
  document.getElementById('evEndTime').value='';
  document.getElementById('evNotes').value='';
  document.getElementById('calModalTitle').textContent='Add Event ‚Äî '+fmtDisplay(dateStr);
  openModal('calModal');
}

function saveEvent(){
  const title=document.getElementById('evTitle').value.trim();if(!title)return;
  const startDate=document.getElementById('evStartDate').value;if(!startDate)return;
  const endDate=document.getElementById('evEndDate').value||startDate;
  events.push({
    id:Date.now(),title,
    date:startDate, // primary date for sorting
    startDate,endDate,
    startTime:document.getElementById('evStartTime').value,
    endTime:document.getElementById('evEndTime').value,
    notes:document.getElementById('evNotes').value.trim(),
    cat:document.getElementById('evCat').value
  });
  S.s('events',events);closeModal('calModal');renderCalendar();renderUpcoming();
}

function deleteEvent(id){events=events.filter(e=>e.id!==id);S.s('events',events);renderCalendar();renderUpcoming();}

// Check if an event spans a given date
function eventOnDate(e,ds){
  const start=e.startDate||e.date;
  const end=e.endDate||e.date;
  return ds>=start&&ds<=end;
}

function renderCalendar(){
  document.getElementById('calMonthLabel').textContent=`${MONTHS[calMonth]} ${calYear}`;
  const grid=document.getElementById('calGrid');
  const todayFmt=fmtDate(new Date());
  const first=new Date(calYear,calMonth,1);
  const startDay=first.getDay();
  const daysInMonth=new Date(calYear,calMonth+1,0).getDate();
  const daysInPrev=new Date(calYear,calMonth,0).getDate();

  let html=DAYS_SHORT.map(d=>`<div class="cal-dh">${d}</div>`).join('');

  for(let i=startDay-1;i>=0;i--){
    html+=`<div class="cal-cell other-month"><div class="cal-dn">${daysInPrev-i}</div></div>`;
  }

  for(let d=1;d<=daysInMonth;d++){
    const ds=`${calYear}-${String(calMonth+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
    const isToday=ds===todayFmt;
    const dayEvts=events.filter(e=>eventOnDate(e,ds)).sort((a,b)=>{
      if(a.startTime&&b.startTime)return a.startTime.localeCompare(b.startTime);return 0;
    });
    html+=`<div class="cal-cell ${isToday?'today':''}" onclick="openDayView('${ds}')">
      <div class="cal-dn">${d}</div>
      ${dayEvts.slice(0,2).map(e=>`<div class="cal-event ${e.cat}">${e.startTime?fmtTime(e.startTime)+' ':''}${e.title}</div>`).join('')}
      ${dayEvts.length>2?`<div style="font-size:10px;color:var(--text3);font-weight:600">+${dayEvts.length-2} more</div>`:''}
    </div>`;
  }
  grid.innerHTML=html;
  renderUpcoming();
}

function openDayView(dateStr){
  const dayEvts=events.filter(e=>eventOnDate(e,dateStr)).sort((a,b)=>{
    if(a.startTime&&b.startTime)return a.startTime.localeCompare(b.startTime);return 0;
  });
  document.getElementById('dayViewTitle').textContent=fmtDisplay(dateStr);
  document.getElementById('dayViewDate').value=dateStr;
  const list=document.getElementById('dayViewList');
  list.innerHTML=dayEvts.length?dayEvts.map(e=>`
    <div style="background:var(--surface2);border:1.5px solid var(--border);border-radius:14px;padding:16px;margin-bottom:12px">
      <div style="display:flex;justify-content:space-between;align-items:flex-start">
        <div style="flex:1">
          <div style="font-weight:700;font-size:16px;margin-bottom:5px">${e.title}</div>
          ${e.startTime?`<div style="font-size:14px;color:var(--accent);font-weight:700;margin-bottom:5px">üïê ${fmtTime(e.startTime)}${e.endTime?' ‚Äì '+fmtTime(e.endTime):''}</div>`:''}
          ${(e.startDate&&e.endDate&&e.startDate!==e.endDate)?`<div style="font-size:13px;color:var(--text3);margin-bottom:5px">üìÜ ${fmtDisplay(e.startDate)} ‚Üí ${fmtDisplay(e.endDate)}</div>`:''}
          <span class="badge ${e.cat}">${e.cat}</span>
          ${e.notes?`<div style="font-size:14px;color:var(--text2);margin-top:10px;line-height:1.6">${e.notes}</div>`:''}
        </div>
        <button class="del-btn" onclick="deleteEvent(${e.id});openDayView('${dateStr}')">√ó</button>
      </div>
    </div>`).join(''):'<div class="empty" style="padding:24px">No events this day.</div>';
  openModal('dayViewModal');
}

function addEventFromDayView(){
  const dateStr=document.getElementById('dayViewDate').value;
  closeModal('dayViewModal');
  setTimeout(()=>openCalModal(dateStr),150);
}

function renderUpcoming(){
  const el=document.getElementById('upcomingEvents');if(!el)return;
  const today=todayStr();
  const upcoming=events.filter(e=>(e.endDate||e.date)>=today).sort((a,b)=>{
    const ad=a.startDate||a.date,bd=b.startDate||b.date;
    if(ad!==bd)return ad.localeCompare(bd);
    if(a.startTime&&b.startTime)return a.startTime.localeCompare(b.startTime);
    return 0;
  }).slice(0,12);
  if(!upcoming.length){el.innerHTML='<div class="empty"><div class="empty-icon">üìÖ</div>No upcoming events.</div>';return;}
  el.innerHTML=upcoming.map(e=>`
    <div class="card" style="padding:16px 20px;margin-bottom:10px">
      <div style="display:flex;justify-content:space-between;align-items:flex-start">
        <div style="flex:1">
          <div style="font-weight:700;font-size:16px">${e.title}</div>
          <div style="font-size:13px;color:var(--text3);margin-top:4px;font-weight:500">
            üìÖ ${fmtDisplay(e.startDate||e.date)}${(e.endDate&&e.endDate!==(e.startDate||e.date))?` ‚Üí ${fmtDisplay(e.endDate)}`:''}
            ${e.startTime?` &nbsp;¬∑&nbsp; üïê ${fmtTime(e.startTime)}${e.endTime?' ‚Äì '+fmtTime(e.endTime):''}` :''}
          </div>
          ${e.notes?`<div style="font-size:13px;color:var(--text2);margin-top:6px;line-height:1.5">${e.notes}</div>`:''}
        </div>
        <div style="display:flex;gap:8px;align-items:center;margin-left:12px;flex-shrink:0">
          <span class="badge ${e.cat}">${e.cat}</span>
          <button class="del-btn" onclick="deleteEvent(${e.id})">√ó</button>
        </div>
      </div>
    </div>`).join('');
}

// ‚îÄ‚îÄ HABITS ‚îÄ‚îÄ
function addHabit(){
  const name=document.getElementById('habitName').value.trim();if(!name)return;
  const h={id:Date.now(),name,createdAt:todayStr()};
  habits.push(h);habitLogs[h.id]={};
  S.s('habits',habits);S.s('habitLogs',habitLogs);
  document.getElementById('habitName').value='';
  renderHabits();
}

function toggleHabitDay(hid,dateStr){
  if(!habitLogs[hid])habitLogs[hid]={};
  habitLogs[hid][dateStr]=!habitLogs[hid][dateStr];
  S.s('habitLogs',habitLogs);renderHabits();renderDashboard();
}

function deleteHabit(id){
  habits=habits.filter(h=>h.id!==id);delete habitLogs[id];
  S.s('habits',habits);S.s('habitLogs',habitLogs);renderHabits();
}

function getStreak(hid){
  let d=new Date();let streak=0;
  for(let i=0;i<365;i++){
    const ds=fmtDate(d);
    if(habitLogs[hid]&&habitLogs[hid][ds]){streak++;}
    else if(i>0)break;
    d.setDate(d.getDate()-1);
  }
  return streak;
}

function renderHabits(){
  const el=document.getElementById('habitsList');
  if(!habits.length){el.innerHTML='<div class="empty"><div class="empty-icon">üî•</div>No habits yet. Start building!</div>';return;}
  const today=todayStr();
  const days7=[];
  for(let i=6;i>=0;i--){const d=new Date();d.setDate(d.getDate()-i);days7.push(fmtDate(d));}
  el.innerHTML=habits.map(h=>{
    const streak=getStreak(h.id);
    const logs=habitLogs[h.id]||{};
    return `
      <div class="habit-row">
        <div class="habit-info">
          <div class="habit-name">${h.name}</div>
          ${streak>0?`<div class="habit-streak">üî• ${streak} day streak</div>`:'<div class="habit-streak" style="color:var(--text3)">No streak yet</div>'}
        </div>
        <div class="habit-checks">
          ${days7.map(ds=>{
            const isToday=ds===today;
            const done=!!logs[ds];
            const dn=parseDate(ds).getDate();
            return `<div class="h-check ${done?'done':''} ${isToday?'today-check':''}" onclick="toggleHabitDay(${h.id},'${ds}')" title="${ds}">${dn}</div>`;
          }).join('')}
        </div>
        <button class="del-btn" style="margin-left:8px" onclick="deleteHabit(${h.id})">√ó</button>
      </div>`;
  }).join('');
}

// ‚îÄ‚îÄ NOTES ‚îÄ‚îÄ
function addNote(isJournal){
  const txt=document.getElementById('noteInput').value.trim();if(!txt)return;
  notes.unshift({id:Date.now(),text:txt,date:todayStr(),journal:isJournal});
  S.s('notes',notes);document.getElementById('noteInput').value='';renderNotes();
}

function deleteNote(id){notes=notes.filter(n=>n.id!==id);S.s('notes',notes);renderNotes();}

function renderNotes(){
  const journals=notes.filter(n=>n.journal);
  const quick=notes.filter(n=>!n.journal);
  document.getElementById('journalList').innerHTML=journals.length?journals.map(n=>`
    <div class="journal-entry">
      <div style="display:flex;justify-content:space-between;align-items:flex-start">
        <div class="journal-date-hd">üìî ${fmtDisplay(n.date)}</div>
        <button class="del-btn" onclick="deleteNote(${n.id})">√ó</button>
      </div>
      <div class="note-text">${n.text}</div>
    </div>`).join(''):'<div class="empty"><div class="empty-icon">üìî</div>No journal entries yet.</div>';
  document.getElementById('notesList').innerHTML=quick.length?quick.map(n=>`
    <div class="note-item">
      <div class="note-header">
        <div class="note-date">${fmtDisplay(n.date)}</div>
        <button class="del-btn" onclick="deleteNote(${n.id})">√ó</button>
      </div>
      <div class="note-text">${n.text}</div>
    </div>`).join(''):'<div class="empty"><div class="empty-icon">üìù</div>No quick notes yet.</div>';
}

// ‚îÄ‚îÄ DASHBOARD ‚îÄ‚îÄ
function renderDashboard(){
  const today=todayStr();
  const todayTodos=todos.filter(t=>t.date===today);
  const done=todayTodos.filter(t=>t.done).length;

  document.getElementById('dashStats').innerHTML=`
    <div class="stat-tile">
      <div class="stat-num" style="color:var(--accent)">${done}/${todayTodos.length}</div>
      <div class="stat-lbl">Tasks Today</div>
    </div>
    <div class="stat-tile">
      <div class="stat-num" style="color:var(--orange)">${habits.length}</div>
      <div class="stat-lbl">Active Habits</div>
    </div>
    <div class="stat-tile">
      <div class="stat-num" style="color:var(--green)">${goals.length}</div>
      <div class="stat-lbl">Goals Set</div>
    </div>`;

  const wdh=document.getElementById('weekDayHeaders');
  wdh.innerHTML=DAYS_SHORT.map(d=>`<div class="week-day-hd">${d}</div>`).join('');
  const d=new Date();const dow=d.getDay();
  const weekStart=new Date(d);weekStart.setDate(d.getDate()-dow);
  let whtml='';
  for(let i=0;i<7;i++){
    const wd=new Date(weekStart);wd.setDate(weekStart.getDate()+i);
    const ds=fmtDate(wd);const isToday=ds===today;
    const dayEvts=events.filter(e=>eventOnDate(e,ds));
    whtml+=`<div class="week-day-cell ${isToday?'today':''}" onclick="gotoPage('calendar',document.querySelectorAll('.nav-item')[4])">
      <div class="week-day-num">${wd.getDate()}</div>
      ${dayEvts.slice(0,2).map(e=>`<div class="week-event-dot" style="background:${e.cat==='work'?'var(--accent)':e.cat==='health'?'var(--red)':e.cat==='finance'?'var(--yellow)':'var(--green)'}"></div>`).join('')}
    </div>`;
  }
  document.getElementById('weekGrid').innerHTML=whtml;

  const todayItems=todos.filter(t=>t.date===today&&!t.done).slice(0,5);
  document.getElementById('dashTodos').innerHTML=todayItems.length?todayItems.map(t=>`
    <div class="todo-item" style="padding:11px 0">
      <div class="check-circle ${t.done?'done':''}" onclick="toggleTodo(${t.id})"></div>
      <div class="todo-text ${t.done?'done':''}" style="font-size:15px;font-weight:500">${t.text}</div>
      <span class="badge ${t.priority}">${t.priority}</span>
    </div>`).join(''):'<div class="empty" style="padding:18px">All clear today! üéâ</div>';

  const logs=habitLogs;
  document.getElementById('dashHabits').innerHTML=habits.length?habits.slice(0,5).map(h=>{
    const done=!!(logs[h.id]&&logs[h.id][today]);
    const streak=getStreak(h.id);
    return `
      <div class="habit-row" style="padding:11px 0">
        <div class="h-check ${done?'done':''} today-check" style="width:28px;height:28px" onclick="toggleHabitDay(${h.id},'${today}')"></div>
        <div class="habit-info"><div class="habit-name" style="font-size:15px">${h.name}</div></div>
        ${streak>0?`<div style="font-size:13px;color:var(--orange);font-weight:700">üî•${streak}</div>`:''}
      </div>`;
  }).join(''):'<div class="empty" style="padding:18px">No habits set up yet.</div>';
}

// ‚îÄ‚îÄ INIT ‚îÄ‚îÄ
function init(){
  initDate();
  renderDashboard();
  renderWeekTabs();
  renderGoals();
  renderRecipes();
  renderCalendar();
  renderHabits();
  renderNotes();
}
init();
</script>
</body>
</html>
